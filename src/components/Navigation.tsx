"use client";
import { PrismicLink } from "@prismicio/react";

import { Button } from "./atoms/Button";
import { useGSAP } from "@gsap/react";
import { MouseEvent, useRef, useState } from "react";
import gsap from "gsap";
import { mergeClassNames } from "@/utils/helpers/mergeClassNames";
import useSmoothScrollStore from "@/utils/hooks/useSmoothScrollStore";
import { isFilled, LinkField } from "@prismicio/client";
import { usePathname, useRouter } from "next/navigation";

import type { NavigationDocument } from "../../prismicio-types";
import { PrismicNextLink } from "@prismicio/next";
import Icon from "./atoms/Icon/Icon";
import { IconSize } from "./atoms/Icon/Icon.types";

interface NavigationProps {
  navigation: NavigationDocument;
  startInverted?: boolean;
}

export const Navigation = ({
  navigation,
  startInverted = false,
}: NavigationProps) => {
  const navRef = useRef<HTMLDivElement>(null);
  const [isOpen, setIsOpen] = useState(false);
  const [hasScrolled, setHasScrolled] = useState(false);
  const pathname = usePathname();
  const { smoother } = useSmoothScrollStore();
  const router = useRouter();

  useGSAP(() => {
    gsap.to(navRef.current, {
      scrollTrigger: {
        trigger: navRef.current,
        scrub: true,
        start: "24px top",
        onEnter: () => setHasScrolled(true),
        onLeave: () => setHasScrolled(false),
        end: "9999999px bottom",
        markers: false,
        invalidateOnRefresh: true,
      },
    });
  });

  // if the url is to a section, scroll to the section
  const handleClick = (event: MouseEvent, field: LinkField) => {
    if (!isFilled.link(field)) {
      return;
    }

    setIsOpen(false);

    if (field.url?.startsWith("#")) {
      const isHomepage = pathname === "/";
      // if we're not on the homepage, adjust the field to prepend a /
      const newUrl = isHomepage ? field.url : field.url.replace("#", "/#");
      event.preventDefault();
      // window.location.href = newUrl;

      if (isHomepage) {
        return smoother?.scrollTo(newUrl, true, "top-=48px top");
      }

      return router.push(newUrl, {
        scroll: false,
      });
    }
  };

  return (
    <>
      <nav
        className={mergeClassNames(
          "h-20 fixed mx-auto flex items-center justify-center w-full z-50 px-4 mt-4",
          "tablet-m:px-2 tablet-m:mt-2",
        )}
        data-gsap="navigation"
      >
        <div
          ref={navRef}
          className={mergeClassNames(
            "transition-colors duration-500 backdrop-blur-lg rounded-3xl flex items-center justify-between h-full w-full max-w-7xl px-4",
            hasScrolled && !isOpen && "bg-off-white-600/75",
            startInverted && !hasScrolled && "text-off-white-500",
            isOpen
              ? "desktop-s:bg-lake-lime-600 desktop-s:text-off-white-500"
              : "desktop-s:bg-off-white-600/75",
          )}
        >
          <PrismicLink
            aria-label={navigation.data.title ?? "Engineers of Innovation logo"}
            href="/"
            className="text-[inherit]"
          >
            <svg
              fill="none"
              height="41"
              viewBox="0 0 180 41"
              width="180"
              className="tablet-s:w-40"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M10.0319 36.2857C11.672 35.8985 12.9235 34.7649 13.7204 33.9455C14.3588 33.2903 14.8961 32.3615 15.5205 31.2868C15.6706 31.0272 15.8249 30.7635 15.9849 30.4913C16.9221 28.9101 18.1707 26.9501 20.3356 24.3994L20.2795 24.3602C18.5958 23.1718 16.981 22.4675 15.477 22.2683C14.2143 22.0999 13.0133 22.2865 11.9077 22.8225C10.4023 23.552 9.08206 24.8989 7.87267 26.9375C7.30866 27.8873 6.81621 28.7993 6.34059 29.6804C6.18626 29.9652 6.03614 30.2458 5.88461 30.5222C5.29254 31.6053 4.63173 32.7726 3.80115 33.9722L3.83763 34.0072C5.93372 35.9953 8.01859 36.7613 10.0333 36.2871L10.0319 36.2857Z"
                fill="#FF7B1F"
              />
              <path
                d="M23.0672 24.4894C21.4018 26.3329 18.1061 31.4132 16.5965 33.8432L16.5937 33.8474C18.6743 35.8762 20.8392 36.6843 23.0251 36.2522C25.0314 35.8551 26.5831 34.5209 27.5315 33.4714C28.4323 32.4753 29.2011 31.1761 30.0163 29.7997L30.3207 29.2876C31.2916 27.6587 32.3677 25.9274 33.8956 24.2368L33.8998 24.2312C31.0713 22.3708 28.7928 21.6216 26.9324 21.9401C25.2236 22.2333 24.0408 23.409 23.0658 24.488L23.0672 24.4894Z"
                fill="#FF7B1F"
              />
              <path
                d="M31.8051 31.4328C31.1807 32.5061 30.7276 33.2875 30.113 33.9722L30.1425 34.0017C31.6086 35.4341 33.1085 36.2802 34.5999 36.5145C35.8247 36.7067 37.0523 36.4864 38.2505 35.8607C39.7741 35.0652 41.281 33.5892 42.6068 31.5927C43.8667 29.6972 45.7874 26.2739 46.6447 24.4023L46.6012 24.363C46.141 23.9491 44.463 22.5728 42.1943 22.2319C40.0491 21.9092 38.2 22.6457 36.6988 24.4205C34.5073 27.0105 33.2347 29.0112 32.3719 30.4661C32.1628 30.8183 31.9762 31.1395 31.8037 31.4356L31.8051 31.4328Z"
                fill="#FF7B1F"
              />
              <path
                d="M26.5649 19.7892C28.7298 19.4174 31.1822 20.0585 34.0331 21.7422C34.1987 21.1908 34.2899 20.6057 34.2899 20.001C34.2899 16.6563 31.5793 13.9456 28.2345 13.9456C24.8897 13.9456 22.1791 16.6563 22.1791 20.001C22.1791 20.6815 22.2928 21.3353 22.499 21.9456C23.5835 20.9312 24.8645 20.0824 26.5649 19.7892Z"
                fill="#FF7B1F"
              />
              <path
                clipRule="evenodd"
                d="M43.6929 18.4073C43.5624 18.2614 43.2074 18.1435 41.6866 17.7325C40.6708 17.4589 39.756 17.1965 39.655 17.1502C39.4376 17.0506 39.3618 16.9089 38.7515 15.4568C38.4947 14.8465 38.2857 14.2446 38.2857 14.1197C38.2857 13.957 38.5663 13.3986 39.272 12.1597C40.0521 10.789 40.2583 10.3723 40.2583 10.1646C40.2583 9.92613 40.1854 9.82791 39.4656 9.08151C38.5649 8.14852 38.2029 7.85809 37.9406 7.8595C37.8353 7.8595 37.0286 8.2804 36.0353 8.85142C35.0882 9.39579 34.2282 9.85878 34.1244 9.87983C33.9911 9.90648 33.5814 9.77039 32.7115 9.40841C31.1472 8.75882 31.1388 8.75461 31.0111 8.47822C30.9522 8.35055 30.673 7.3965 30.391 6.35828C30.0136 4.9665 29.8368 4.42494 29.7175 4.29586L29.5562 4.12189H26.6548L26.4934 4.29586C26.3728 4.42634 26.2044 4.95668 25.82 6.42843C25.538 7.50594 25.2644 8.4698 25.2125 8.57222C25.1059 8.77847 24.9599 8.85423 23.4728 9.47155C22.9003 9.70866 22.3293 9.90368 22.2044 9.90368C22.0389 9.90368 21.4903 9.62869 20.2388 8.91736C18.9018 8.15693 18.4444 7.93105 18.2508 7.93105C18.0277 7.93105 17.914 8.01242 17.2476 8.6536C16.3202 9.54451 15.954 9.99627 15.954 10.2488C15.954 10.3639 16.3441 11.1159 16.946 12.1639C17.4917 13.1124 17.9547 13.985 17.9744 14.1029C18.001 14.2628 17.8748 14.643 17.4693 15.6181C17.1719 16.3337 16.8604 16.9903 16.7762 17.0758C16.6626 17.1909 16.1154 17.3719 14.6857 17.7675C13.3501 18.1365 12.6991 18.3498 12.5896 18.4522C12.4353 18.5967 12.4311 18.6374 12.4311 20.0657C12.4311 20.1512 12.4311 20.2312 12.4311 20.307C13.4974 20.0208 14.6128 19.952 15.7632 20.1049C17.2153 20.2971 18.7194 20.8499 20.2486 21.7465C20.1252 21.1796 20.0564 20.5918 20.0564 19.9885C20.0564 15.4399 23.7435 11.7528 28.2921 11.7528C32.8406 11.7528 36.5277 15.4399 36.5277 19.9885C36.5277 20.582 36.4632 21.1614 36.3439 21.7184C38.5228 19.9604 40.835 19.8201 42.5158 20.0727C42.9816 20.1428 43.4263 20.2466 43.8472 20.3743C43.8472 20.2747 43.8472 20.1681 43.8472 20.0502C43.8472 18.6318 43.843 18.5813 43.6887 18.4101L43.6929 18.4073Z"
                fill="#FF7B1F"
                fillRule="evenodd"
              />
              <path
                d="M57.6053 17.4634C56.5447 17.4634 55.6149 17.267 54.8162 16.8742C54.0174 16.4813 53.3954 15.9052 52.9502 15.1457C52.518 14.3862 52.302 13.4696 52.302 12.3958C52.302 11.3744 52.518 10.484 52.9502 9.72447C53.3954 8.96497 54.0108 8.37571 54.7965 7.95668C55.5822 7.52455 56.5054 7.30849 57.5661 7.30849C58.5743 7.30849 59.4582 7.49181 60.2177 7.85847C60.9903 8.21202 61.5861 8.73581 62.0052 9.42983C62.4373 10.1108 62.6534 10.9488 62.6534 11.944C62.6534 12.1143 62.6468 12.2779 62.6337 12.4351C62.6206 12.5791 62.601 12.7232 62.5748 12.8672H53.6573V11.6887H61.1802L60.6302 12.4154C60.6433 12.2845 60.6499 12.1601 60.6499 12.0422C60.6499 11.9113 60.6499 11.7803 60.6499 11.6494C60.6499 10.7459 60.388 10.078 59.8642 9.6459C59.3535 9.20068 58.5743 8.97807 57.5268 8.97807C56.3613 8.97807 55.5298 9.24651 55.0322 9.78339C54.5346 10.3203 54.2858 11.0929 54.2858 12.1012V12.6119C54.2858 13.6332 54.5346 14.4124 55.0322 14.9493C55.5298 15.4861 56.3679 15.7546 57.5464 15.7546C58.5678 15.7546 59.3011 15.5975 59.7463 15.2832C60.2046 14.9558 60.4338 14.504 60.4338 13.9279V13.7707H62.5551V13.9475C62.5551 14.6415 62.3391 15.257 61.907 15.7939C61.4879 16.3177 60.9052 16.7301 60.1588 17.0313C59.4255 17.3194 58.5743 17.4634 57.6053 17.4634ZM74.6329 17.267H72.5115V11.9637C72.5115 11.047 72.2889 10.3596 71.8437 9.90124C71.4116 9.44293 70.6848 9.21377 69.6634 9.21377C68.6028 9.21377 67.8171 9.48876 67.3064 10.0387C66.8088 10.5756 66.56 11.3744 66.56 12.4351L66.1868 12.4547L66.0886 10.5298H66.5207C66.6255 9.97981 66.835 9.46257 67.1492 8.97807C67.4766 8.48047 67.9218 8.08108 68.4849 7.7799C69.0611 7.46563 69.7616 7.30849 70.5866 7.30849C71.4901 7.30849 72.2431 7.49181 72.8454 7.85847C73.4478 8.22512 73.893 8.71617 74.1811 9.33162C74.4823 9.94708 74.6329 10.6345 74.6329 11.394V17.267ZM66.56 17.267H64.4386V7.50491H66.3832V10.5691L66.56 10.6673V17.267ZM81.8461 20.8026C80.8771 20.8026 80.026 20.652 79.2927 20.3508C78.5594 20.0628 77.9832 19.6437 77.5642 19.0937C77.1582 18.5438 76.9552 17.8759 76.9552 17.0902H79.057C79.057 17.5617 79.1552 17.9414 79.3516 18.2295C79.548 18.5176 79.8557 18.7205 80.2748 18.8384C80.7069 18.9693 81.27 19.0348 81.964 19.0348C82.7104 19.0348 83.2996 18.9497 83.7318 18.7795C84.177 18.6223 84.4978 18.3408 84.6942 17.9349C84.8907 17.5289 84.9889 16.9659 84.9889 16.2456V10.5298L85.146 10.3923V7.50491H87.0906V16.1278C87.0906 17.2146 86.8745 18.0985 86.4424 18.7795C86.0103 19.4735 85.4013 19.9842 84.6157 20.3116C83.83 20.6389 82.9068 20.8026 81.8461 20.8026ZM80.9622 16.3831C79.9932 16.3831 79.1617 16.1933 78.4677 15.8135C77.7868 15.4338 77.2564 14.9034 76.8767 14.2225C76.51 13.5416 76.3267 12.7493 76.3267 11.8458C76.3267 10.9423 76.5166 10.15 76.8963 9.46912C77.2892 8.78819 77.8391 8.25786 78.5463 7.87811C79.2665 7.49836 80.1176 7.30849 81.0997 7.30849C82.1211 7.30849 82.9854 7.53765 83.6925 7.99596C84.4127 8.44118 84.8579 9.08937 85.0281 9.94053H85.4799L85.3621 11.6494H84.9889C84.9889 11.0994 84.8579 10.6411 84.596 10.2744C84.3341 9.8947 83.9609 9.61316 83.4764 9.42983C82.9919 9.24651 82.4027 9.15485 81.7086 9.15485C81.0408 9.15485 80.4581 9.23996 79.9605 9.41019C79.476 9.58042 79.1028 9.86196 78.8409 10.2548C78.5921 10.6345 78.4677 11.1649 78.4677 11.8458C78.4677 12.5136 78.5921 13.044 78.8409 13.4368C79.0897 13.8297 79.4498 14.1177 79.9212 14.3011C80.4057 14.4713 80.9819 14.5564 81.6497 14.5564C82.7235 14.5564 83.5484 14.3338 84.1246 13.8886C84.7008 13.4434 84.9889 12.7886 84.9889 11.9244H85.3621V13.8493H84.8514C84.6811 14.5957 84.2687 15.2046 83.6139 15.676C82.9592 16.1474 82.0753 16.3831 80.9622 16.3831ZM91.3712 17.267H89.2498V7.50491H91.3712V17.267ZM91.3712 6.36567H89.2498V4.10683H91.3712V6.36567ZM103.726 17.267H101.605V11.9637C101.605 11.047 101.382 10.3596 100.937 9.90124C100.505 9.44293 99.7781 9.21377 98.7567 9.21377C97.6961 9.21377 96.9104 9.48876 96.3997 10.0387C95.9021 10.5756 95.6533 11.3744 95.6533 12.4351L95.2801 12.4547L95.1819 10.5298H95.614C95.7188 9.97981 95.9283 9.46257 96.2426 8.97807C96.5699 8.48047 97.0151 8.08108 97.5782 7.7799C98.1544 7.46563 98.855 7.30849 99.6799 7.30849C100.583 7.30849 101.336 7.49181 101.939 7.85847C102.541 8.22512 102.986 8.71617 103.274 9.33162C103.576 9.94708 103.726 10.6345 103.726 11.394V17.267ZM95.6533 17.267H93.5319V7.50491H95.4765V10.5691L95.6533 10.6673V17.267ZM110.723 17.4634C109.663 17.4634 108.733 17.267 107.934 16.8742C107.135 16.4813 106.513 15.9052 106.068 15.1457C105.636 14.3862 105.42 13.4696 105.42 12.3958C105.42 11.3744 105.636 10.484 106.068 9.72447C106.513 8.96497 107.129 8.37571 107.915 7.95668C108.7 7.52455 109.623 7.30849 110.684 7.30849C111.692 7.30849 112.576 7.49181 113.336 7.85847C114.108 8.21202 114.704 8.73581 115.123 9.42983C115.555 10.1108 115.771 10.9488 115.771 11.944C115.771 12.1143 115.765 12.2779 115.752 12.4351C115.739 12.5791 115.719 12.7232 115.693 12.8672H106.775V11.6887H114.298L113.748 12.4154C113.761 12.2845 113.768 12.1601 113.768 12.0422C113.768 11.9113 113.768 11.7803 113.768 11.6494C113.768 10.7459 113.506 10.078 112.982 9.6459C112.472 9.20068 111.692 8.97807 110.645 8.97807C109.479 8.97807 108.648 9.24651 108.15 9.78339C107.653 10.3203 107.404 11.0929 107.404 12.1012V12.6119C107.404 13.6332 107.653 14.4124 108.15 14.9493C108.648 15.4861 109.486 15.7546 110.664 15.7546C111.686 15.7546 112.419 15.5975 112.864 15.2832C113.323 14.9558 113.552 14.504 113.552 13.9279V13.7707H115.673V13.9475C115.673 14.6415 115.457 15.257 115.025 15.7939C114.606 16.3177 114.023 16.7301 113.277 17.0313C112.544 17.3194 111.692 17.4634 110.723 17.4634ZM122.467 17.4634C121.407 17.4634 120.477 17.267 119.678 16.8742C118.879 16.4813 118.257 15.9052 117.812 15.1457C117.38 14.3862 117.164 13.4696 117.164 12.3958C117.164 11.3744 117.38 10.484 117.812 9.72447C118.257 8.96497 118.873 8.37571 119.658 7.95668C120.444 7.52455 121.367 7.30849 122.428 7.30849C123.436 7.30849 124.32 7.49181 125.08 7.85847C125.852 8.21202 126.448 8.73581 126.867 9.42983C127.299 10.1108 127.515 10.9488 127.515 11.944C127.515 12.1143 127.509 12.2779 127.496 12.4351C127.482 12.5791 127.463 12.7232 127.437 12.8672H118.519V11.6887H126.042L125.492 12.4154C125.505 12.2845 125.512 12.1601 125.512 12.0422C125.512 11.9113 125.512 11.7803 125.512 11.6494C125.512 10.7459 125.25 10.078 124.726 9.6459C124.215 9.20068 123.436 8.97807 122.389 8.97807C121.223 8.97807 120.392 9.24651 119.894 9.78339C119.396 10.3203 119.148 11.0929 119.148 12.1012V12.6119C119.148 13.6332 119.396 14.4124 119.894 14.9493C120.392 15.4861 121.23 15.7546 122.408 15.7546C123.43 15.7546 124.163 15.5975 124.608 15.2832C125.067 14.9558 125.296 14.504 125.296 13.9279V13.7707H127.417V13.9475C127.417 14.6415 127.201 15.257 126.769 15.7939C126.35 16.3177 125.767 16.7301 125.021 17.0313C124.287 17.3194 123.436 17.4634 122.467 17.4634ZM131.422 17.267H129.3V7.50491H131.245V10.2744L131.422 10.3727V17.267ZM131.422 11.7869H130.95V10.137H131.383C131.474 9.60007 131.658 9.12211 131.933 8.70308C132.208 8.27095 132.574 7.93049 133.032 7.68169C133.504 7.43289 134.074 7.30849 134.741 7.30849C135.488 7.30849 136.097 7.46563 136.568 7.7799C137.039 8.09417 137.38 8.5132 137.589 9.03699C137.812 9.56078 137.923 10.1304 137.923 10.7459V12.0226H135.822V11.1583C135.822 10.4512 135.665 9.93398 135.35 9.60661C135.036 9.27925 134.512 9.11556 133.779 9.11556C132.941 9.11556 132.338 9.34472 131.972 9.80303C131.605 10.2613 131.422 10.9226 131.422 11.7869ZM144.068 17.4634C142.497 17.4634 141.279 17.1623 140.415 16.5599C139.564 15.9576 139.138 15.0933 139.138 13.9672V13.9082H141.259V14.0654C141.259 14.707 141.469 15.1522 141.888 15.401C142.32 15.6367 143.047 15.7546 144.068 15.7546C145.024 15.7546 145.672 15.6564 146.013 15.46C146.366 15.2504 146.543 14.9296 146.543 14.4975C146.543 14.0916 146.406 13.8035 146.131 13.6332C145.869 13.463 145.384 13.3321 144.677 13.2404L142.006 12.8868C141.076 12.769 140.349 12.5071 139.825 12.1012C139.302 11.6821 139.04 11.0601 139.04 10.2352C139.04 9.65899 139.21 9.15485 139.55 8.72272C139.891 8.2775 140.402 7.93049 141.083 7.68169C141.763 7.43289 142.602 7.30849 143.597 7.30849C144.592 7.30849 145.443 7.43944 146.15 7.70133C146.87 7.96323 147.42 8.35607 147.8 8.87986C148.193 9.40365 148.389 10.0518 148.389 10.8244V10.8833H146.288V10.7655C146.288 10.3857 146.209 10.0649 146.052 9.80303C145.895 9.54114 145.613 9.34472 145.207 9.21377C144.815 9.06973 144.258 8.99771 143.538 8.99771C142.634 8.99771 142.006 9.10247 141.652 9.31198C141.299 9.5215 141.122 9.85541 141.122 10.3137C141.122 10.6935 141.253 10.9685 141.515 11.1387C141.777 11.3089 142.268 11.4464 142.988 11.5512L145.247 11.8655C146.399 12.0095 147.25 12.291 147.8 12.7101C148.35 13.1291 148.625 13.7445 148.625 14.5564C148.625 15.1588 148.435 15.6826 148.055 16.1278C147.676 16.5599 147.145 16.8938 146.464 17.1295C145.784 17.3521 144.985 17.4634 144.068 17.4634ZM57.6839 36.4634C56.6101 36.4634 55.6608 36.2539 54.8358 35.8349C54.0239 35.4028 53.3888 34.807 52.9305 34.0475C52.4853 33.2749 52.2627 32.391 52.2627 31.3958C52.2627 30.3744 52.4853 29.484 52.9305 28.7245C53.3888 27.965 54.0239 27.3757 54.8358 26.9567C55.6608 26.5246 56.6101 26.3085 57.6839 26.3085C58.7839 26.3085 59.7398 26.5246 60.5516 26.9567C61.3635 27.3757 61.9921 27.965 62.4373 28.7245C62.8956 29.484 63.1248 30.3744 63.1248 31.3958C63.1248 32.391 62.8956 33.2749 62.4373 34.0475C61.9921 34.807 61.3635 35.4028 60.5516 35.8349C59.7398 36.2539 58.7839 36.4634 57.6839 36.4634ZM57.6839 34.5778C58.8755 34.5778 59.7332 34.3094 60.257 33.7725C60.7808 33.2225 61.0427 32.4303 61.0427 31.3958C61.0427 30.3613 60.7808 29.5691 60.257 29.0191C59.7332 28.456 58.8755 28.1745 57.6839 28.1745C56.5054 28.1745 55.6542 28.456 55.1304 29.0191C54.6066 29.5691 54.3447 30.3613 54.3447 31.3958C54.3447 32.4303 54.6066 33.2225 55.1304 33.7725C55.6542 34.3094 56.5054 34.5778 57.6839 34.5778ZM67.7284 36.267H65.607V27.0352C65.607 26.2103 65.7838 25.5097 66.1374 24.9335C66.504 24.3443 67.0344 23.8925 67.7284 23.5782C68.4224 23.264 69.267 23.1068 70.2622 23.1068H71.2247V24.6782H69.9283C69.0902 24.6782 68.4813 24.8353 68.1016 25.1496C67.7218 25.4508 67.5974 26.027 67.7284 26.8781V27.271V36.267ZM71.2247 28.2727H64.1339V26.5049H71.2247V28.2727ZM78.27 36.267H76.1487V26.5049H78.27V36.267ZM78.27 25.3657H76.1487V23.1068H78.27V25.3657ZM90.6251 36.267H88.5037V30.9637C88.5037 30.047 88.2811 29.3596 87.8359 28.9012C87.4038 28.4429 86.677 28.2138 85.6556 28.2138C84.5949 28.2138 83.8093 28.4888 83.2986 29.0387C82.801 29.5756 82.5522 30.3744 82.5522 31.4351L82.179 31.4547L82.0808 29.5298H82.5129C82.6176 28.9798 82.8272 28.4626 83.1414 27.9781C83.4688 27.4805 83.914 27.0811 84.4771 26.7799C85.0533 26.4656 85.7538 26.3085 86.5788 26.3085C87.4823 26.3085 88.2353 26.4918 88.8376 26.8585C89.44 27.2251 89.8852 27.7162 90.1733 28.3316C90.4745 28.9471 90.6251 29.6345 90.6251 30.394V36.267ZM82.5522 36.267H80.4308V26.5049H82.3754V29.5691L82.5522 29.6673V36.267ZM102.906 36.267H100.785V30.9637C100.785 30.047 100.562 29.3596 100.117 28.9012C99.6847 28.4429 98.9579 28.2138 97.9365 28.2138C96.8759 28.2138 96.0902 28.4888 95.5795 29.0387C95.0819 29.5756 94.8331 30.3744 94.8331 31.4351L94.4599 31.4547L94.3617 29.5298H94.7938C94.8986 28.9798 95.1081 28.4626 95.4223 27.9781C95.7497 27.4805 96.1949 27.0811 96.758 26.7799C97.3342 26.4656 98.0347 26.3085 98.8597 26.3085C99.7632 26.3085 100.516 26.4918 101.119 26.8585C101.721 27.2251 102.166 27.7162 102.454 28.3316C102.755 28.9471 102.906 29.6345 102.906 30.394V36.267ZM94.8331 36.267H92.7117V26.5049H94.6563V29.5691L94.8331 29.6673V36.267ZM109.982 36.4634C108.908 36.4634 107.959 36.2539 107.134 35.8349C106.322 35.4028 105.687 34.807 105.228 34.0475C104.783 33.2749 104.561 32.391 104.561 31.3958C104.561 30.3744 104.783 29.484 105.228 28.7245C105.687 27.965 106.322 27.3757 107.134 26.9567C107.959 26.5246 108.908 26.3085 109.982 26.3085C111.082 26.3085 112.038 26.5246 112.849 26.9567C113.661 27.3757 114.29 27.965 114.735 28.7245C115.193 29.484 115.423 30.3744 115.423 31.3958C115.423 32.391 115.193 33.2749 114.735 34.0475C114.29 34.807 113.661 35.4028 112.849 35.8349C112.038 36.2539 111.082 36.4634 109.982 36.4634ZM109.982 34.5778C111.173 34.5778 112.031 34.3094 112.555 33.7725C113.079 33.2225 113.341 32.4303 113.341 31.3958C113.341 30.3613 113.079 29.5691 112.555 29.0191C112.031 28.456 111.173 28.1745 109.982 28.1745C108.803 28.1745 107.952 28.456 107.428 29.0191C106.904 29.5691 106.643 30.3613 106.643 31.3958C106.643 32.4303 106.904 33.2225 107.428 33.7725C107.952 34.3094 108.803 34.5778 109.982 34.5778ZM123.424 36.267H120.832L116.275 26.5049H118.612L122.089 34.2046H122.246L125.722 26.5049H128.021L123.424 36.267ZM138.537 36.267H136.592V33.7528L136.455 33.6939V30.3548C136.455 29.5429 136.258 28.9798 135.866 28.6655C135.486 28.3382 134.825 28.1745 133.882 28.1745C132.978 28.1745 132.304 28.3316 131.859 28.6459C131.413 28.9602 131.191 29.4774 131.191 30.1976V30.2762H129.089V30.1976C129.089 29.4512 129.285 28.7899 129.678 28.2138C130.071 27.6245 130.634 27.1596 131.368 26.8192C132.114 26.4787 133.004 26.3085 134.039 26.3085C135.073 26.3085 135.918 26.4853 136.573 26.8388C137.241 27.1793 137.732 27.6507 138.046 28.2531C138.373 28.8554 138.537 29.5494 138.537 30.3351V36.267ZM132.173 36.4634C131.165 36.4634 130.359 36.2408 129.757 35.7956C129.168 35.3373 128.873 34.7088 128.873 33.91C128.873 33.3993 128.997 32.9737 129.246 32.6332C129.508 32.2797 129.875 32.0047 130.346 31.8083C130.818 31.6119 131.374 31.4744 132.016 31.3958L136.651 30.9047V32.1618L132.625 32.6136C132.075 32.6791 131.662 32.7969 131.387 32.9672C131.125 33.1243 130.994 33.3927 130.994 33.7725C130.994 34.1653 131.132 34.46 131.407 34.6564C131.695 34.8397 132.14 34.9314 132.742 34.9314C133.489 34.9314 134.137 34.8397 134.687 34.6564C135.237 34.46 135.669 34.1588 135.983 33.7528C136.298 33.3469 136.455 32.8231 136.455 32.1815L136.73 32.2208V33.8314H136.455C136.193 34.6564 135.689 35.3046 134.942 35.776C134.209 36.2343 133.286 36.4634 132.173 36.4634ZM147.03 36.267H144.791C143.743 36.267 142.912 36.0117 142.297 35.501C141.694 34.9903 141.393 34.1457 141.393 32.9672V24.3639H143.495V32.8493C143.495 33.4517 143.639 33.8576 143.927 34.0671C144.215 34.2635 144.66 34.3617 145.262 34.3617H147.03V36.267ZM147.03 28.2727H139.743V26.5049H147.03V28.2727ZM150.675 36.267H148.554V26.5049H150.675V36.267ZM150.675 25.3657H148.554V23.1068H150.675V25.3657ZM157.825 36.4634C156.751 36.4634 155.802 36.2539 154.977 35.8349C154.165 35.4028 153.53 34.807 153.071 34.0475C152.626 33.2749 152.404 32.391 152.404 31.3958C152.404 30.3744 152.626 29.484 153.071 28.7245C153.53 27.965 154.165 27.3757 154.977 26.9567C155.802 26.5246 156.751 26.3085 157.825 26.3085C158.925 26.3085 159.881 26.5246 160.693 26.9567C161.504 27.3757 162.133 27.965 162.578 28.7245C163.037 29.484 163.266 30.3744 163.266 31.3958C163.266 32.391 163.037 33.2749 162.578 34.0475C162.133 34.807 161.504 35.4028 160.693 35.8349C159.881 36.2539 158.925 36.4634 157.825 36.4634ZM157.825 34.5778C159.016 34.5778 159.874 34.3094 160.398 33.7725C160.922 33.2225 161.184 32.4303 161.184 31.3958C161.184 30.3613 160.922 29.5691 160.398 29.0191C159.874 28.456 159.016 28.1745 157.825 28.1745C156.646 28.1745 155.795 28.456 155.271 29.0191C154.748 29.5691 154.486 30.3613 154.486 31.3958C154.486 32.4303 154.748 33.2225 155.271 33.7725C155.795 34.3094 156.646 34.5778 157.825 34.5778ZM175.196 36.267H173.074V30.9637C173.074 30.047 172.852 29.3596 172.407 28.9012C171.974 28.4429 171.248 28.2138 170.226 28.2138C169.166 28.2138 168.38 28.4888 167.869 29.0387C167.372 29.5756 167.123 30.3744 167.123 31.4351L166.75 31.4547L166.651 29.5298H167.084C167.188 28.9798 167.398 28.4626 167.712 27.9781C168.04 27.4805 168.485 27.0811 169.048 26.7799C169.624 26.4656 170.325 26.3085 171.15 26.3085C172.053 26.3085 172.806 26.4918 173.408 26.8585C174.011 27.2251 174.456 27.7162 174.744 28.3316C175.045 28.9471 175.196 29.6345 175.196 30.394V36.267ZM167.123 36.267H165.002V26.5049H166.946V29.5691L167.123 29.6673V36.267Z"
                fill="currentColor"
              />
            </svg>
          </PrismicLink>

          <ul
            className={mergeClassNames(
              "flex items-center gap-6",
              "desktop-s:fixed desktop-s:top-24 desktop-s:left-0 desktop-s:w-full desktop-s:h-dvh desktop-s:backdrop-blur-xl",
              "desktop-s:bg-lake-lime-600 desktop-s:justify-center desktop-s:gap-10 desktop-s:p-4 desktop-s:rounded-3xl desktop-s:overflow-y-scroll",
              isOpen ? "desktop-s:flex-col" : "desktop-s:hidden",
            )}
          >
            {navigation.data.slices.map((slice) => {
              const LinkElement = isFilled.link(slice.primary.link)
                ? PrismicNextLink
                : "p";
              return (
                <li
                  className="font-heading font-medium group relative desktop-s:flex desktop-s:gap-10"
                  key={slice.id}
                >
                  <LinkElement
                    field={slice.primary.link}
                    className={mergeClassNames(
                      "text-[18px] text-[inherit] desktop-s:text-heading-2-xl",
                      !isFilled.link(slice.primary.link) && "desktop-s:hidden",
                    )}
                    onClick={(event: MouseEvent) =>
                      handleClick(event, slice.primary.link)
                    }
                  >
                    <span>{slice.primary.link.text}</span>
                  </LinkElement>

                  {/* Renders child links, if present. */}
                  {slice.items.length > 0 && (
                    <div
                      className={mergeClassNames(
                        "gap-12 items-center hidden absolute top-full pt-2 -left-2 w-40 text-left flex-col",
                        "hover:flex group-hover:flex",
                        "desktop-s:flex desktop-s:static desktop-s:pt-0",
                      )}
                    >
                      <ul
                        className={mergeClassNames(
                          "flex flex-col gap-3 w-full",
                          "bg-off-white-600 px-4 py-2 rounded-lg",
                          "desktop-s:bg-lake-lime-600 desktop-s:px-0 desktop-s:py-0 desktop-s:gap-10",
                        )}
                      >
                        {slice.items.map((item) => {
                          const LinkElement = isFilled.link(item.child_link)
                            ? PrismicNextLink
                            : "p";
                          return (
                            <li key={JSON.stringify(item)}>
                              <LinkElement
                                field={item.child_link}
                                onClick={(event: MouseEvent) =>
                                  handleClick(event, item.child_link)
                                }
                                className="text-[18px] text-[inherit] w-full flex gap-3 items-center desktop-s:text-heading-2-xl desktop-s:justify-center"
                              >
                                <span>{item.child_link.text}</span>

                                {item.child_link.link_type !== "Document" && (
                                  <Icon name="arrow" size={IconSize.XSmall} />
                                )}
                              </LinkElement>
                            </li>
                          );
                        })}
                      </ul>
                    </div>
                  )}
                </li>
              );
            })}
            {navigation.data.buttons.map(
              (button) =>
                isFilled.link(button.link) && (
                  <li
                    className="font-heading font-medium desktop-s:block hidden"
                    key={button.title}
                  >
                    <PrismicLink
                      field={button.link}
                      className="text-[18px] text-[inherit] desktop-s:text-heading-2-xl"
                      onClick={(event: MouseEvent) =>
                        handleClick(event, button.link)
                      }
                    >
                      <span>{button.title}</span>
                    </PrismicLink>
                  </li>
                ),
            )}
          </ul>

          <div className={mergeClassNames("hidden desktop-s:flex")}>
            <button
              className=" p-2 flex items-center justify-center"
              onClick={() => setIsOpen(!isOpen)}
            >
              <svg
                width="26"
                height="19"
                viewBox="0 0 26 19"
                className={
                  isOpen ? "opacity-0 absolute" : "opacity-100 absolute"
                }
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M1.44444 18.1636H24.5556C25.35 18.1636 26 17.5136 26 16.7192C26 15.9247 25.35 15.2747 24.5556 15.2747H1.44444C0.65 15.2747 0 15.9247 0 16.7192C0 17.5136 0.65 18.1636 1.44444 18.1636ZM1.44444 10.9414H24.5556C25.35 10.9414 26 10.2914 26 9.49696C26 8.70251 25.35 8.05251 24.5556 8.05251H1.44444C0.65 8.05251 0 8.70251 0 9.49696C0 10.2914 0.65 10.9414 1.44444 10.9414ZM0 2.27474C0 3.06918 0.65 3.71918 1.44444 3.71918H24.5556C25.35 3.71918 26 3.06918 26 2.27474C26 1.48029 25.35 0.830292 24.5556 0.830292H1.44444C0.65 0.830292 0 1.48029 0 2.27474Z"
                  fill="#133131"
                />
              </svg>

              <svg
                width="35"
                height="35"
                viewBox="0 0 35 35"
                className={isOpen ? "opacity-100" : "opacity-0"}
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M26.5948 8.62528C26.4664 8.49667 26.314 8.39463 26.1461 8.32501C25.9783 8.25539 25.7984 8.21955 25.6167 8.21955C25.435 8.21955 25.2551 8.25539 25.0873 8.32501C24.9194 8.39463 24.767 8.49667 24.6386 8.62528L17.8545 15.3956L11.0703 8.6114C10.9418 8.48296 10.7894 8.38107 10.6215 8.31156C10.4537 8.24205 10.2739 8.20627 10.0922 8.20627C9.91056 8.20627 9.73069 8.24205 9.56287 8.31156C9.39505 8.38107 9.24256 8.48296 9.11412 8.6114C8.98568 8.73985 8.88379 8.89233 8.81428 9.06015C8.74476 9.22797 8.70898 9.40784 8.70898 9.58949C8.70898 9.77114 8.74476 9.951 8.81428 10.1188C8.88379 10.2866 8.98568 10.4391 9.11412 10.5676L15.8983 17.3517L9.11412 24.1359C8.98568 24.2643 8.88379 24.4168 8.81428 24.5847C8.74476 24.7525 8.70898 24.9323 8.70898 25.114C8.70898 25.2956 8.74476 25.4755 8.81428 25.6433C8.88379 25.8111 8.98568 25.9636 9.11412 26.0921C9.24256 26.2205 9.39505 26.3224 9.56287 26.3919C9.73069 26.4614 9.91056 26.4972 10.0922 26.4972C10.2739 26.4972 10.4537 26.4614 10.6215 26.3919C10.7894 26.3224 10.9418 26.2205 11.0703 26.0921L17.8545 19.3079L24.6386 26.0921C24.7671 26.2205 24.9195 26.3224 25.0874 26.3919C25.2552 26.4614 25.4351 26.4972 25.6167 26.4972C25.7983 26.4972 25.9782 26.4614 26.146 26.3919C26.3139 26.3224 26.4663 26.2205 26.5948 26.0921C26.7232 25.9636 26.8251 25.8111 26.8946 25.6433C26.9641 25.4755 26.9999 25.2956 26.9999 25.114C26.9999 24.9323 26.9641 24.7525 26.8946 24.5847C26.8251 24.4168 26.7232 24.2643 26.5948 24.1359L19.8106 17.3517L26.5948 10.5676C27.122 10.0404 27.122 9.15247 26.5948 8.62528Z"
                  fill="#f9f4eb"
                />
              </svg>
            </button>
          </div>

          <div
            className={mergeClassNames(
              "flex items-center gap-3",
              "desktop-s:hidden",
            )}
          >
            {navigation.data.buttons.map((button) => (
              <Button
                field={button.link}
                size="m"
                key={button.title}
                className={mergeClassNames(
                  startInverted &&
                    !hasScrolled &&
                    button.variant === "tertiary" &&
                    "!text-off-white-600 !border-off-white-600",
                )}
                variant={button.variant ?? "tertiary"}
              >
                {button.title}
              </Button>
            ))}
          </div>
        </div>
      </nav>

      {/* Backdrop */}
      <div
        className={mergeClassNames(
          "fixed top-0 left-0 w-full h-dvh bg-lake-lime-500/75 z-40 backdrop-blur-xl",
          "transition-all duration-200 ease-in-out pointer-events-none",
          isOpen ? "desktop-s:opacity-100" : "opacity-0",
        )}
      />
    </>
  );
};
